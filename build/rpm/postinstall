#
# create directories
#
dirs="/var/npstats
/var/npstats/queue
/var/npstats/queue/spool
/var/npstats/queue/sent
/var/npstats/queue/lock
/var/npstats/queue/status
/var/npstats/archive
/var/npstats/archive/csv
/var/npstats/archive/sqlite
/var/npstats/www
/var/log/npstats
/var/run/npstats
/usr/local/etc/npstats/defaults
/usr/local/etc/npstats/site
/usr/local/etc/npstats/private
/usr/local/etc/npstats/rc.d/monitor
/usr/local/libexec/npstats/site
/usr/local/libexec/npstats/tclhttpd/site
/usr/local/libexec/npstats/tclhttpd/importers"

for d in $dirs
do
  install -d -m 755 $d
done

#
# install optional files from doc directory
#
docdir=/usr/local/share/doc/npstats
confdir=/usr/local/etc/npstats
rcdir=/etc/init.d

install -m 0755 $docdir/npstatsd.sh-sample $rcdir/npstatsd
if [ -n "`which chkconfig`" ]
then
        chkconfig --add npstatsd
elif [ -n "`which update-rc.d`" ]
then
        update-rc.d npstatsd defaults 99
fi

#
# configure default
#
cd $confdir/dist
for file in *.conf-sample *.def-sample *.rc-sample
do
  name=${file%%"-sample"}
  cp $file ../$name
done

for file in *-private
do
  name=${file%%"-private"}
  cp $file ../private/$name
done

for file in *-defaults
do
  name=${file%%"-defaults"}
  cp $file ../defaults/$name
done

for file in *-templates.tgz
do
  tar -C ../defaults -xzf $file
done

#
# www and tclhttpd
#
cp /usr/local/share/doc/npstats/www.tgz /var/npstats/www
cd /var/npstats/www
tar -xzf www.tgz
rm www.tgz
chown -R root:root *
cd htdocs/pub
#
# Note: If we reverse the test [ ! -e ...] && ....
# the statement will return 1 if rst exists and pkg_add will
# think that the script is returning an error.
#
[ -d "plots" ] || mkdir plots
# [ -e "plotdata" ] || ln -s /var/npstats/plotdata 

cat <<__EOF__
-
If the qrunner is configured to upload directly to a mysql database,
then the mysql client command line tool is required; for example

    yum install mysql

The directory
	
    /usr/local/share/doc/npstats

contains documentation and examples to get started.

In order to monitor a novra s75 device, the "novrapoll" application
must be installed in the directory

	/usr/local/libexec/npstats/pollers

The web server is enabled by default, and can be accesed as
        
        http://localhost:8025
or
        http://<hostname>:8025
-
__EOF__
